{% extends 'base.html' %}

{% block content %}
<div class="dashboard-layout">
  <main class="dashboard-content">

    <!-- Heading -->
    <div class="container-fluid mb-4">
      <div class="d-flex flex-column flex-md-row align-items-md-center justify-content-md-between gap-2 mb-3">
        <div>
          <h2 class="mb-0">Home</h2>
          <p class="text-muted mb-0">Semester overview and prediction</p>
        </div>
      </div>

      <!-- Top summary cards -->
      {% if semester %}
      <div class="row g-3">
        <div class="col-md-6 col-12">
          <div class="card shadow-sm border-0 stat-card primary">
            <div class="card-body">
              <p class="text-muted small mb-1">Overall Attendance</p>
              <h3 class="mb-1">{{ overall_sem_percentage }}%</h3>
              <p class="mb-0 small text-muted fst-italic">
                {{ semester['name'] }}<br>
                {{ semester['start_date'] }} to {{ semester['end_date'] }}
              </p>
            </div>
          </div>
        </div>

        <div class="col-md-6 col-12">
          <div class="card shadow-sm border-0 stat-card purple prediction-card">
            <div class="card-body">
              <div>
                <p class="text-muted small mb-1">Predicted Attendance</p>
                <p class="mb-0 small prediction-text">
                  Predicted semester attendance based on your current pattern.
                </p>
              </div>
              <div class="mt-3 mt-md-0 text-md-end">
                <h3 class="mb-1">{{ predicted_attendance }}%</h3>
                {% if predicted_attendance >= 75 %}
                  <span class="badge bg-success">On Track</span>
                {% else %}
                  <span class="badge bg-danger">At Risk</span>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick action -->
      <div class="text-center my-4">
        <button class="btn btn-primary"
                onclick="window.location='{{ url_for('mark_date', date_str=today_str) }}'">
          <i class="bi bi-check-circle me-2"></i>
          Mark Today's Attendance
        </button>
      </div>

      <!-- Monthly breakdown table -->
      <div class="card mx-auto" style="max-width: 720px;">
        <div class="card-header text-center">Monthly Breakdown</div>
        <div class="table-responsive rounded-bottom">
          <table class="table mb-0">
            <thead>
              <tr>
                <th class="text-center">Month</th>
                <th class="text-center">Attendance (%)</th>
              </tr>
            </thead>
            <tbody>
              {% for m in monthly_percentages %}
              <tr>
                <td class="text-center">{{ m.month }}</td>
                <td class="text-center">{{ m.percentage }}%</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
        <div class="card-body small text-muted text-center">
          You must attend <strong>{{ lectures_must_attend }}</strong> more lectures to reach 75%.
          {% if not possible_to_reach %}
            <span class="text-danger fw-semibold d-block mt-1">
              It is not possible to reach 75% anymore.
            </span>
          {% endif %}
        </div>
      </div>

      {% else %}
      <!-- No semester set -->
      <div class="card mx-auto" style="max-width: 520px;">
        <div class="card-header">No Semester Set</div>
        <div class="card-body text-center">
          <p class="mb-3">Please add a semester to start tracking attendance.</p>
          <a href="{{ url_for('manage_semesters') }}" class="btn btn-primary">
            Add Semester
          </a>
        </div>
      </div>
      {% endif %}
    </div>

  </main>
</div>
{% endblock %}
