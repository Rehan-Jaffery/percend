{% extends 'base.html' %}
{% block content %}

<div class="card mx-auto">
  {% if semester %}
    <div class="card-header">Overall Attendance</div>
    <div class="card-body text-center">
      <h1 class="display-4">{{ overall_sem_percentage }}%</h1>
      <p class="text-muted fst-italic">{{ semester['name'] }}<br />{{ semester['start_date'] }} to {{ semester['end_date'] }}</p>
    </div>
  {% else %}
    <div class="card-header">No Semester Set</div>
    <div class="card-body text-center">
      <p>Please add a semester to start tracking attendance.</p>
      <a href="{{ url_for('manage_semesters') }}" class="btn btn-primary">Add Semester</a>
    </div>
  {% endif %}
</div>

{% if semester %}
<div class="text-center my-4">
  <button class="btn btn-primary" onclick="window.location='{{ url_for('mark_date', date_str=today_str) }}'">
    <i class="bi bi-check-circle me-2"></i>Mark Today's Attendance
  </button>
</div>

<div class="card mx-auto">
  <div class="card-header">Attendance Prediction</div>
  <div class="card-body text-center">
    <p>Predicted Semester Attendance:</p>
    <h2 class="text-accent">{{ predicted_attendance }}%</h2>
    {% if predicted_attendance < 75 %}
      <p class="text-danger fw-semibold">‚ö†Ô∏è Warning: At current rate, you may not meet required attendance!</p>
    {% else %}
      <p class="text-success fw-semibold">üëç You are on track!</p>
    {% endif %}
    <p>You must attend <strong>{{ lectures_must_attend }}</strong> more lectures to reach 75%.</p>
    {% if not possible_to_reach %}
      <p class="text-danger fw-semibold">It is <strong>not possible</strong> to reach 75% anymore.</p>
    {% endif %}
  </div>
</div>

<div class="card mx-auto">
  <div class="card-header text-center">Monthly Breakdown</div>
  <div class="table-responsive rounded-bottom">
    <table class="table mb-0">
      <thead>
        <tr>
          <th class="text-center">Month</th>
          <th class="text-center">Attendance (%)</th>
        </tr>
      </thead>
      <tbody>
        {% for m in monthly_percentages %}
        <tr>
          <td class="text-center">{{ m.month }}</td>
          <td class="text-center">{{ m.percentage }}%</td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% endif %}

{% endblock %}
